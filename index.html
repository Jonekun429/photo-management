<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Cleaner Pro - Prototype</title>
    <style>
        :root {
            --bg:#04100e;--card:#0c1f1b;--card2:#153029;--text:#eaf5f2;--sub:#5a7d75;--dim:#3d5c54;
            --pri:#005D4D;--pri2:#00896e;--bright:#00b894;--grad:linear-gradient(135deg,#005D4D,#00896e);
            --glow:rgba(0,93,77,.25);--danger:#ff4757;--dgrad:linear-gradient(135deg,#ff4757,#ff6b7a);
            --amber:#ffb142;--badge:rgba(4,16,14,.82);--bdr:rgba(0,93,77,.12);--bdr2:rgba(0,93,77,.3);
            --sh:0 8px 32px rgba(0,0,0,.4);--rl:20px;--rm:14px;--rs:10px;
        }
        *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
        body{font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","Helvetica Neue",sans-serif;background:#000;display:flex;justify-content:center;touch-action:manipulation;-webkit-font-smoothing:antialiased}
        #app{width:100%;max-width:414px;height:100vh;height:100dvh;background:var(--bg);color:var(--text);position:relative;display:flex;flex-direction:column;overflow:hidden}

        header{padding:52px 20px 10px;display:flex;flex-direction:column;gap:10px;z-index:20;background:var(--bg);flex-shrink:0}
        .h-top{display:flex;justify-content:space-between;align-items:center;height:36px}
        .back{font-size:24px;cursor:pointer;display:none;padding:4px 14px 4px 0;color:var(--bright);transition:opacity .2s;font-weight:300}
        .back:active{opacity:.4}
        .h-act{display:none;gap:8px;align-items:center}
        .h-tr{display:flex;justify-content:space-between;align-items:flex-end}
        h1{font-size:28px;font-weight:700;letter-spacing:-.5px}
        .h-sub{font-size:12.5px;color:var(--sub);margin-top:2px;display:none}
        .gear{background:var(--card);border:1px solid var(--bdr);border-radius:50%;width:38px;height:38px;display:flex;justify-content:center;align-items:center;font-size:17px;cursor:pointer}

        .view{flex:1;overflow-y:auto;padding:0 20px 110px;display:none;-webkit-overflow-scrolling:touch;scrollbar-width:none}
        .view::-webkit-scrollbar{display:none}
        .view.active{display:block;animation:fi .3s ease}
        @keyframes fi{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

        /* ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ãƒãƒ« */
        .access{background:var(--card);border:1px solid var(--bdr2);border-radius:var(--rl);padding:20px;margin-top:15px;overflow:hidden}
        .access-head{text-align:center;margin-bottom:15px}
        .access-head h4{font-size:15px;font-weight:700;margin-bottom:4px}
        .access-head p{font-size:12px;color:var(--sub);line-height:1.5}
        .a-btn{width:100%;padding:14px;border:none;border-radius:12px;font-size:14.5px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:all .2s;background:var(--grad);color:#fff;box-shadow:0 4px 16px rgba(0,93,77,.3)}
        .a-btn:active{transform:scale(.97)}
        .a-btn.danger{background:var(--dgrad);box-shadow:0 4px 16px rgba(255,71,87,.3)}
        .a-btn.secondary{background:var(--card2);color:var(--bright);border:1px solid var(--bdr2);box-shadow:none}
        .file-in{display:none}

        /* Home */
        .sto-row{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:10px}
        .sto-u{font-size:12.5px;color:var(--sub)}.sto-u strong{color:var(--bright);font-weight:600}
        .sto-p{font-size:11px;font-weight:700;color:var(--amber);background:rgba(255,177,66,.1);padding:3px 8px;border-radius:6px}
        .prog{width:100%;height:5px;background:rgba(255,255,255,.04);border-radius:3px;overflow:hidden}
        .pf{width:0;height:100%;background:var(--grad);border-radius:3px;transition:width 1.2s cubic-bezier(.25,.46,.45,.94)}
        
        .gh{display:grid;grid-template-columns:1fr 1fr;gap:13px;margin-top:22px}
        .gc{border-radius:var(--rl);height:130px;position:relative;overflow:hidden;display:flex;flex-direction:column;justify-content:flex-end;padding:15px;cursor:pointer;background:var(--card2);background-size:cover;background-position:center;box-shadow:var(--sh)}
        .gc.full{grid-column: 1 / -1; height: 110px;}
        .gc::before{content:'';position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,.88) 0%,rgba(0,0,0,.25) 55%,rgba(0,0,0,.08) 100%);z-index:1}
        .gc>div{position:relative;z-index:2}
        .gc.all-photos{background-image:url('https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=600&q=80'); background-position: top;}
        .gc h3{font-size:12.5px;font-weight:500;margin-bottom:2px;opacity:.7}
        .gc p{font-size:21px;font-weight:700;letter-spacing:-.3px}
        .gc.full p{font-size:26px;}
        .gc .cnt{font-size:10.5px;color:rgba(255,255,255,.45);margin-top:1px}

        /* Media Grid */
        .mg{display:grid;grid-template-columns:1fr 1fr 1fr;gap:4px}
        .mi{aspect-ratio:1/1;position:relative;background:var(--card2);overflow:hidden}
        .mi img{width:100%;height:100%;object-fit:cover;display:block;}

        /* ã‚¹ãƒ¯ã‚¤ãƒ—æ©Ÿèƒ½ */
        .swipe-header-stats { display: flex; gap: 10px; margin-bottom: 20px; }
        .stat-box { flex: 1; background: var(--card); border: 1px solid var(--bdr); border-radius: var(--rm); padding: 12px; display: flex; align-items: center; gap: 10px; }
        .stat-ic { font-size: 24px; }
        .stat-v { font-size: 16px; font-weight: bold; }
        .stat-l { font-size: 10px; color: var(--sub); }

        .month-list { display: flex; flex-direction: column; gap: 12px; }
        .month-card { background: var(--card); border: 1px solid var(--bdr); border-radius: var(--rm); padding: 15px; display: flex; gap: 15px; align-items: center; cursor: pointer; transition: transform .2s; }
        .month-card:active { transform: scale(0.98); background: var(--card2); }
        .mc-thumb { width: 60px; height: 60px; border-radius: 10px; background-size: cover; background-position: center; flex-shrink: 0; position: relative; background-color: var(--dim); }
        .mc-thumb.done::after { content: 'âœ“'; position: absolute; inset: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; font-size: 24px; color: #fff; border-radius: inherit; }
        .mc-info { flex: 1; }
        .mc-title { font-size: 16px; font-weight: bold; margin-bottom: 6px; display: flex; justify-content: space-between; }
        .mc-prog-text { font-size: 11px; color: var(--sub); margin-bottom: 4px; }
        .mc-prog-bar { width: 100%; height: 4px; background: rgba(255,255,255,0.06); border-radius: 2px; overflow: hidden; }
        .mc-prog-fill { height: 100%; background: var(--bright); border-radius: 2px; transition: width 0.3s; }

        /* ã‚¹ãƒ¯ã‚¤ãƒ— ãƒ—ãƒ¬ã‚¤ç”»é¢ */
        #swipe-play { display: none; flex-direction: column; height: 100%; padding-bottom: 20px; }
        .sp-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .sp-prog-wrap { flex: 1; margin: 0 15px; }
        .sp-counts { font-size: 11px; color: var(--sub); text-align: right; margin-bottom: 4px; }
        .sp-img-container { flex: 1; background: var(--card); border-radius: var(--rl); position: relative; overflow: hidden; box-shadow: var(--sh); display: flex; align-items: center; justify-content: center; }
        .sp-img { max-width: 100%; max-height: 100%; object-fit: contain; border-radius: var(--rl); transition: transform 0.3s ease, opacity 0.3s ease; }
        .swipe-left { transform: translateX(-100%) rotate(-10deg); opacity: 0; }
        .swipe-right { transform: translateX(100%) rotate(10deg); opacity: 0; }
        .sz-badge { position:absolute; bottom:15px; left:15px; background:var(--badge); backdrop-filter:blur(6px); color:#fff; font-size:14px; font-weight:700; padding:6px 12px; border-radius:10px; z-index:2; border:1px solid rgba(255,255,255,0.1); }
        
        .sp-actions { display: flex; justify-content: center; gap: 20px; margin-top: 25px; }
        .sp-btn { width: 72px; height: 72px; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer; transition: transform 0.1s; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .sp-btn:active { transform: scale(0.9); }
        .btn-dislike { background: var(--card); color: var(--danger); border: 2px solid var(--danger); }
        .btn-like { background: var(--card); color: var(--bright); border: 2px solid var(--bright); }

        /* ãƒªã‚¶ãƒ«ãƒˆ(çµæœ)ç”»é¢ */
        .res-container { display:flex; flex-direction:column; align-items:center; text-align:center; padding:20px 0; animation:fi .5s ease; }
        .res-icon { width:80px; height:80px; background:var(--grad); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:40px; margin-bottom:20px; box-shadow:0 10px 30px var(--glow); }
        .res-container h2 { font-size:22px; font-weight:700; margin-bottom:8px; }
        .res-container p { font-size:13px; color:var(--sub); margin-bottom:30px; }
        
        .res-stats { width:100%; display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:35px; }
        .rs-box { background:var(--card); border:1px solid var(--bdr); border-radius:var(--rm); padding:18px 10px; display:flex; flex-direction:column; align-items:center; }
        .rs-box.danger { border-color:rgba(255,71,87,0.3); background:linear-gradient(to bottom, var(--card), rgba(255,71,87,0.05)); }
        .rs-box span { font-size:11px; color:var(--sub); margin-bottom:6px; font-weight:600; }
        .rs-box strong { font-size:24px; font-weight:800; }
        .rs-box.danger strong { color:var(--danger); }
        .rs-box small { font-size:11px; color:var(--danger); margin-top:4px; font-weight:600; background:rgba(255,71,87,0.15); padding:3px 8px; border-radius:6px; }

        .empty { display:none; flex-direction:column; align-items:center; justify-content:center; padding:60px 20px; text-align:center; }
        .e-ic { width:76px; height:76px; background:linear-gradient(135deg,rgba(0,93,77,.18),rgba(0,184,148,.08)); border:1px solid rgba(0,93,77,.18); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:34px; margin-bottom:18px; }
        
        nav{position:absolute;bottom:0;left:0;width:100%;height:78px;background:rgba(4,16,14,.94);backdrop-filter:blur(25px);-webkit-backdrop-filter:blur(25px);display:flex;justify-content:space-around;align-items:center;padding-bottom:18px;border-top:1px solid var(--bdr);z-index:40}
        .ni{display:flex;flex-direction:column;align-items:center;color:var(--dim);font-size:10px;cursor:pointer;transition:color .25s;padding:4px 10px;font-weight:500}
        .ni.on{color:var(--bright)}
        .nic{font-size:22px;margin-bottom:2px}
        .nd{width:4px;height:4px;border-radius:50%;background:var(--bright);margin-top:2px;opacity:0;transition:opacity .25s}
        .ni.on .nd{opacity:1}
    </style>
</head>
<body>
<div id="app">
    <header>
        <div class="h-top">
            <div id="back" class="back" onclick="goBack()">â€¹</div>
            <div id="act" class="h-act"></div>
            <div id="gear" class="gear">âš™</div>
        </div>
        <div class="h-tr">
            <div><h1 id="title">ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸</h1><div id="sub" class="h-sub"></div></div>
        </div>
    </header>

    <main id="home" class="view active">
        <div>
            <div class="sto-row">
                <div class="sto-u"><strong id="sto-txt">0 MB</strong> / èª­ã¿è¾¼ã¿æ¸ˆã¿</div>
                <div class="sto-p" id="sto-pct">---</div>
            </div>
            <div class="prog"><div class="pf" id="prog" style="width: 0%;"></div></div>

            <div class="access" id="access-panel">
                <div class="access-head">
                    <h4>ã‚¹ãƒãƒ›ã®å†™çœŸã‚’èª­ã¿è¾¼ã‚€</h4>
                    <p>ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸå†™çœŸã®æ’®å½±æ—¥ã‚’è§£æã—ã¦ã€<br>è‡ªå‹•ã§æœˆåˆ¥ã®ã‚¹ãƒ¯ã‚¤ãƒ—ã‚’ç”Ÿæˆã—ã¾ã™</p>
                </div>
                <button class="a-btn" onclick="document.getElementById('fi-files').click()">
                    ğŸ“¸ å†™çœŸã‚’é¸æŠã™ã‚‹
                </button>
                <input type="file" id="fi-files" class="file-in" accept="image/*,video/*" multiple onchange="handleFiles(this.files)">
            </div>

            <div class="gh" id="home-grid">
                <div class="gc full all-photos" onclick="go('all')">
                    <div><h3>ã™ã¹ã¦ã®å†™çœŸ</h3><p id="h-all-sz">0 MB</p><div class="cnt" id="h-all-cnt">0 æš</div></div>
                </div>
            </div>
        </div>
    </main>

    <main id="all" class="view">
        <div id="all-grid" class="mg"></div>
        <div id="all-empty" class="empty" style="display:flex;"><div class="e-ic">âœ¨</div><h3>å†™çœŸãŒã‚ã‚Šã¾ã›ã‚“</h3><p>ãƒ›ãƒ¼ãƒ ã‹ã‚‰å†™çœŸã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„</p></div>
    </main>

    <main id="swipe" class="view">
        <div id="swipe-list-view">
            <div class="swipe-header-stats">
                <div class="stat-box"><div class="stat-ic">ğŸ…</div><div><div class="stat-l">æ•´ç†æ¸ˆã¿</div><div class="stat-v" id="reward-cnt">0/0</div></div></div>
                <div class="stat-box"><div class="stat-ic">ğŸ§¹</div><div><div class="stat-l">è§£æ”¾ã—ãŸå®¹é‡</div><div class="stat-v" id="cleaned-sz">0 MB</div></div></div>
            </div>
            <div class="month-list" id="month-list-container">
                <div class="empty" style="display:flex; padding:20px;"><p>ãƒ›ãƒ¼ãƒ ã‹ã‚‰å†™çœŸã‚’èª­ã¿è¾¼ã‚€ã¨<br>ã“ã“ã«æœˆåˆ¥ã®ã‚¹ãƒ¯ã‚¤ãƒ—ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p></div>
            </div>
        </div>

        <div id="swipe-play">
            <div class="sp-top">
                <div class="sp-prog-wrap">
                    <div class="sp-counts"><span id="sp-curr">0</span> / <span id="sp-total">0</span> ä»¶ã‚’ç¢ºèªæ¸ˆã¿</div>
                    <div class="mc-prog-bar"><div class="mc-prog-fill" id="sp-prog-bar" style="width: 0%;"></div></div>
                </div>
            </div>
            <div class="sp-img-container">
                <img id="sp-img" class="sp-img" src="">
                <div class="sz-badge" id="sp-size"></div>
            </div>
            <div class="sp-actions">
                <button class="sp-btn btn-dislike" onclick="handleSwipe('del')">ğŸ‘</button>
                <button class="sp-btn btn-like" onclick="handleSwipe('keep')">ğŸ‘</button>
            </div>
        </div>
    </main>

    <main id="results" class="view">
        <div class="res-container">
            <div class="res-icon">âœ¨</div>
            <h2>ã‚¹ãƒ¯ã‚¤ãƒ—å®Œäº†ï¼</h2>
            <p id="res-month-title">2026å¹´2æœˆã®æ•´ç†ãŒçµ‚ã‚ã‚Šã¾ã—ãŸ</p>
            
            <div class="res-stats">
                <div class="rs-box safe">
                    <span>æ®‹ã™å†™çœŸ</span>
                    <strong id="res-keep-cnt">0</strong>
                </div>
                <div class="rs-box danger">
                    <span>å‰Šé™¤ã™ã‚‹å†™çœŸ</span>
                    <strong id="res-del-cnt">0</strong>
                    <small id="res-del-sz">0 MB è§£æ”¾</small>
                </div>
            </div>
            
            <button class="a-btn danger" onclick="executeNativeDeleteMock()">
                ğŸ—‘ iPhoneã‹ã‚‰å‰Šé™¤ã™ã‚‹
            </button>
            <button class="a-btn secondary" style="margin-top:12px" onclick="go('swipe'); renderSwipeList();">
                ã‚ã¨ã§å‰Šé™¤ã™ã‚‹
            </button>
        </div>
    </main>

    <nav>
        <div class="ni on" data-t="home"><div class="nic">ğŸ </div><span>ãƒ›ãƒ¼ãƒ </span><div class="nd"></div></div>
        <div class="ni" data-t="swipe"><div class="nic">ğŸƒ</div><span>ã‚¹ãƒ¯ã‚¤ãƒ—</span><div class="nd"></div></div>
        <div class="ni" data-t="all"><div class="nic">ğŸ“</div><span>ã™ã¹ã¦</span><div class="nd"></div></div>
    </nav>
</div>

<script>
let globalFiles = []; 
let swipeMonthsData = {}; 
let currentView = 'home';
let swipeActiveMonthKey = null;
let cleanedTotalMB = 0;
let totalInitialMB = 0;

function go(id) {
    currentView = id;
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    
    const titles = { home:'ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸', all:'ã™ã¹ã¦ã®å†™çœŸ', swipe:'å†™çœŸã‚’ã‚¹ãƒ¯ã‚¤ãƒ—', results:'æ•´ç†çµæœ' };
    document.getElementById('title').innerText = titles[id] || id;

    const backBtn = document.getElementById('back');
    const gearBtn = document.getElementById('gear');
    
    if (id === 'home' || id === 'swipe' || id === 'results') {
        backBtn.style.display = 'none'; gearBtn.style.display = 'flex';
        if (id === 'swipe') {
            document.getElementById('swipe-list-view').style.display = 'block';
            document.getElementById('swipe-play').style.display = 'none';
        }
    } else {
        backBtn.style.display = 'block'; gearBtn.style.display = 'none';
    }
}

function goBack() {
    if (document.getElementById('swipe-play').style.display === 'flex') {
        go('swipe'); renderSwipeList();
    } else {
        go('home'); document.querySelectorAll('.ni').forEach(x => x.classList.remove('on')); document.querySelector('.ni[data-t="home"]').classList.add('on');
    }
}

function handleFiles(filesList) {
    if(!filesList.length) return;
    
    globalFiles = [];
    swipeMonthsData = {};
    totalInitialMB = 0;
    cleanedTotalMB = 0;

    for(let f of filesList) {
        if(!f.type.startsWith('image/')) continue;
        
        let d = new Date(f.lastModified);
        let mKey = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
        let sz = parseFloat((f.size / 1024 / 1024).toFixed(2));
        totalInitialMB += sz;
        
        let photoObj = { id: Math.random().toString(36).substr(2,9), url: URL.createObjectURL(f), szMB: sz, monthKey: mKey };
        globalFiles.push(photoObj);

        if(!swipeMonthsData[mKey]) {
            swipeMonthsData[mKey] = {
                id: mKey, title: `${d.getFullYear()}å¹´${d.getMonth()+1}æœˆ`,
                total: 0, done: 0, photos: [],
                kept: [], deleted: [], savedMB: 0, isCleaned: false // çµæœãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ç”¨
            };
        }
        swipeMonthsData[mKey].total++;
        swipeMonthsData[mKey].photos.push(photoObj);
    }

    updateHomeStats();
    renderAllPhotos();
    renderSwipeList();
    go('swipe'); 
}

function updateHomeStats() {
    let currentTotalMB = globalFiles.reduce((sum, p) => sum + p.szMB, 0);
    document.getElementById('h-all-sz').innerText = currentTotalMB.toFixed(1) + ' MB';
    document.getElementById('h-all-cnt').innerText = globalFiles.length + ' æš';
    
    document.getElementById('sto-txt').innerText = currentTotalMB.toFixed(1) + ' MB';
    document.getElementById('sto-pct').innerText = globalFiles.length > 0 ? 'èª­è¾¼æ¸ˆ' : '---';
    
    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ãƒ€ãƒŸãƒ¼æ¼”å‡ºï¼ˆå…ƒã®å®¹é‡ã«å¯¾ã™ã‚‹ç¾åœ¨ã®å‰²åˆï¼‰
    let pct = totalInitialMB > 0 ? (currentTotalMB / totalInitialMB) * 100 : 0;
    document.getElementById('prog').style.width = pct + '%';
}

function renderAllPhotos() {
    const grid = document.getElementById('all-grid');
    grid.innerHTML = globalFiles.map(p => `
        <div class="mi" id="img-${p.id}"><img src="${p.url}" loading="lazy"></div>
    `).join('');
    document.getElementById('all-empty').style.display = globalFiles.length ? 'none' : 'flex';
}

function renderSwipeList() {
    const cont = document.getElementById('month-list-container');
    const monthsArr = Object.values(swipeMonthsData).sort((a,b) => b.id.localeCompare(a.id));
    if(monthsArr.length === 0) return;
    
    let compCount = 0;
    
    cont.innerHTML = monthsArr.map(m => {
        const pct = (m.done / m.total) * 100;
        const isComp = m.done === m.total;
        if(isComp) compCount++;
        const thumbUrl = m.photos.length > 0 ? m.photos[0].url : '';
        
        return `
            <div class="month-card" onclick="startSwipe('${m.id}')">
                <div class="mc-thumb ${m.isCleaned ? 'done' : ''}" style="background-image:url('${thumbUrl}')"></div>
                <div class="mc-info">
                    <div class="mc-title"><span>${m.title}</span></div>
                    <div class="mc-prog-text">${m.done}/${m.total} ä»¶ã‚’ç¢ºèªæ¸ˆã¿</div>
                    <div class="mc-prog-bar"><div class="mc-prog-fill" style="width: ${pct}%"></div></div>
                </div>
            </div>
        `;
    }).join('');
    
    document.getElementById('reward-cnt').innerText = `${compCount}/${monthsArr.length}`;
    document.getElementById('cleaned-sz').innerText = `${cleanedTotalMB.toFixed(1)} MB`;
}

function startSwipe(monthKey) {
    const month = swipeMonthsData[monthKey];
    if (month.isCleaned) { alert("ã“ã®æœˆã¯ã™ã§ã«å‰Šé™¤å®Œäº†ã—ã¦ã„ã¾ã™ã€‚"); return; }
    if (month.done >= month.total) { showResults(monthKey); return; } // ã‚„ã‚Šæ®‹ã—ã®çµæœç”»é¢ã¸
    
    swipeActiveMonthKey = monthKey;
    document.getElementById('title').innerText = month.title;
    document.getElementById('back').style.display = 'block';
    
    document.getElementById('swipe-list-view').style.display = 'none';
    document.getElementById('swipe-play').style.display = 'flex';
    updateSwipeCard();
}

function updateSwipeCard() {
    const month = swipeMonthsData[swipeActiveMonthKey];
    document.getElementById('sp-curr').innerText = month.done;
    document.getElementById('sp-total').innerText = month.total;
    document.getElementById('sp-prog-bar').style.width = ((month.done / month.total) * 100) + '%';
    
    if (month.done >= month.total) {
        setTimeout(() => showResults(swipeActiveMonthKey), 400);
        return;
    }
    
    const currentImg = month.photos[month.done];
    const imgEl = document.getElementById('sp-img');
    
    imgEl.className = 'sp-img'; 
    setTimeout(() => {
        imgEl.src = currentImg.url;
        document.getElementById('sp-size').innerText = currentImg.szMB + " MB";
    }, 50);
}

function handleSwipe(action) {
    const imgEl = document.getElementById('sp-img');
    const month = swipeMonthsData[swipeActiveMonthKey];
    const currentImg = month.photos[month.done];
    
    if (action === 'del') {
        imgEl.classList.add('swipe-left');
        month.deleted.push(currentImg);
        month.savedMB += currentImg.szMB;
    } else {
        imgEl.classList.add('swipe-right');
        month.kept.push(currentImg);
    }
    
    month.done += 1;
    setTimeout(() => updateSwipeCard(), 300);
}

// === çµæœç”»é¢ã¨æ“¬ä¼¼å‰Šé™¤ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ===
function showResults(monthKey) {
    const month = swipeMonthsData[monthKey];
    swipeActiveMonthKey = monthKey; // ä¿æŒ
    
    // ãƒªã‚¶ãƒ«ãƒˆç”»é¢ã«æ•°å€¤ã‚’ã‚»ãƒƒãƒˆ
    document.getElementById('res-month-title').innerText = `${month.title} ã®æ•´ç†ãŒçµ‚ã‚ã‚Šã¾ã—ãŸ`;
    document.getElementById('res-keep-cnt').innerText = `${month.kept.length} æš`;
    document.getElementById('res-del-cnt').innerText = `${month.deleted.length} æš`;
    document.getElementById('res-del-sz').innerText = `${month.savedMB.toFixed(1)} MB è§£æ”¾å¯èƒ½`;
    
    go('results');
}

function executeNativeDeleteMock() {
    const month = swipeMonthsData[swipeActiveMonthKey];
    
    if(month.deleted.length === 0) {
        alert("å‰Šé™¤ã™ã‚‹å†™çœŸãŒã‚ã‚Šã¾ã›ã‚“ï¼ç´ æ™´ã‚‰ã—ã„æ•´ç†æ•´é “ã§ã™ã€‚");
        month.isCleaned = true;
        go('swipe'); renderSwipeList(); return;
    }

    // iOSã®ãƒã‚¤ãƒ†ã‚£ãƒ–å‰Šé™¤ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’æ¨¡ã—ãŸã‚¢ãƒ©ãƒ¼ãƒˆ
    if(confirm(`"${month.title}" ã®å†™çœŸ ${month.deleted.length}æš ã‚’iPhoneã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\n(â€»ã“ã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã¯ã€ã‚¢ãƒ—ãƒªåŒ–å¾Œã®iOSæ¨™æº–ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™)`)) {
        
        // 1. globalFiles(ã™ã¹ã¦ã®å†™çœŸ)ã‹ã‚‰å‰Šé™¤äºˆå®šã®å†™çœŸã‚’æœ¬å½“ã«å–ã‚Šé™¤ã
        const deletedIds = month.deleted.map(p => p.id);
        globalFiles = globalFiles.filter(p => !deletedIds.includes(p.id));
        
        // 2. è§£æ”¾å®¹é‡ã‚’ãƒˆãƒ¼ã‚¿ãƒ«ã«åŠ ç®—
        cleanedTotalMB += month.savedMB;
        month.isCleaned = true; // å‡¦ç†å®Œäº†ãƒ•ãƒ©ã‚°
        
        // 3. UIã®æ›´æ–°
        updateHomeStats();
        renderAllPhotos();
        renderSwipeList();
        
        alert(`âœ¨ å‰Šé™¤ãŒå®Œäº†ã—ã¾ã—ãŸï¼\nãƒ‡ãƒã‚¤ã‚¹ã®ç©ºãå®¹é‡ãŒ ${month.savedMB.toFixed(1)} MB å¢—ãˆã¾ã—ãŸã€‚`);
        go('swipe');
    }
}

document.querySelectorAll('.ni').forEach(n => {
    n.addEventListener('click', (e) => {
        document.querySelectorAll('.ni').forEach(x => x.classList.remove('on'));
        e.currentTarget.classList.add('on');
        go(e.currentTarget.dataset.t);
    });
});
</script>
</body>
</html>
