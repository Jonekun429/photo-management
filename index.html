<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Cleaner Pro - Interactive Prototype</title>
    <style>
        :root {
            /* Cleaner Gurué¢¨ãƒ€ãƒ¼ã‚¯ãƒã‚¤ãƒ“ãƒ¼ãƒ†ãƒ¼ãƒ */
            --bg: #10121a;
            --surface: #1c1e2b;
            --surface-light: #2a2d3e;
            --text: #ffffff;
            --subtext: #9aa0b8;
            --accent: #5e6ad2;
            --success: #3ec4b5;
            --danger: #d94a55;
            --border: rgba(255, 255, 255, 0.08);
            --radius: 18px;
            --btn-blue: #4c56c0;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif; background: #000; display: flex; justify-content: center; touch-action: manipulation; -webkit-font-smoothing: antialiased; color: var(--text); }
        #app { width: 100%; max-width: 414px; height: 100vh; height: 100dvh; background: var(--bg); position: relative; display: flex; flex-direction: column; overflow: hidden; }

        /* å…±é€šãƒ˜ãƒƒãƒ€ãƒ¼ */
        header { padding: 50px 20px 15px; flex-shrink: 0; z-index: 20; background: var(--bg); display: flex; justify-content: space-between; align-items: center; }
        h1 { font-size: 26px; font-weight: 700; letter-spacing: 0.5px; }

        /* è©³ç´°ç”»é¢ç”¨ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .sub-header { padding: 50px 20px 15px; background: var(--bg); display: flex; justify-content: space-between; align-items: center; }
        .sh-left { display: flex; align-items: center; gap: 10px; font-size: 20px; font-weight: 600; }
        .sh-back { cursor: pointer; font-size: 24px; padding-right: 10px; }
        .sh-actions { display: flex; gap: 10px; }
        .btn-round { width: 36px; height: 36px; border-radius: 50%; background: var(--surface-light); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 18px; }
        .btn-capsule { padding: 8px 16px; border-radius: 20px; background: var(--surface-light); display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 600; cursor: pointer; transition: background 0.2s; }
        .btn-capsule:active { background: var(--surface); }

        /* ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ */
        .view { flex: 1; overflow-y: auto; padding: 0 20px 100px; display: none; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .view::-webkit-scrollbar { display: none; }
        .view.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- ãƒ›ãƒ¼ãƒ ç”»é¢ --- */
        .storage-info { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 8px; font-size: 12px; font-weight: 600; }
        .s-text { color: var(--subtext); transition: color 0.3s; }
        .s-text .blue { color: var(--accent); font-size: 14px; transition: all 0.3s; }
        .s-pct { color: var(--text); transition: all 0.3s; }
        .s-bar-bg { width: 100%; height: 6px; background: var(--surface-light); border-radius: 4px; margin-bottom: 20px; overflow: hidden; }
        .s-bar-fill { height: 100%; background: var(--accent); border-radius: 4px; width: 26.8%; transition: width 0.5s cubic-bezier(0.25, 0.8, 0.25, 1); }

        .search-bar { background: var(--surface); border-radius: 12px; padding: 10px 16px; display: flex; align-items: center; gap: 10px; margin-bottom: 20px; color: var(--subtext); font-size: 14px; }

        .masonry { display: flex; gap: 12px; }
        .m-col { flex: 1; display: flex; flex-direction: column; gap: 12px; }
        
        .card { background: var(--surface); border-radius: var(--radius); position: relative; overflow: hidden; cursor: pointer; background-size: cover; background-position: center; transition: transform 0.2s; }
        .card:active { transform: scale(0.96); }
        .card::after { content: ''; position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.1) 60%, rgba(0,0,0,0) 100%); z-index: 1; }
        .card-content { position: absolute; bottom: 16px; left: 16px; right: 16px; z-index: 2; }
        .card h3 { font-size: 14px; font-weight: 600; margin-bottom: 2px; text-shadow: 0 1px 3px rgba(0,0,0,0.5); }
        .card p { font-size: 20px; font-weight: 800; text-shadow: 0 1px 3px rgba(0,0,0,0.5); transition: all 0.3s; }

        .c-sim { height: 200px; background-image: url('https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=400&q=80'); }
        .c-vid-sim { height: 160px; background-image: url('https://images.unsplash.com/photo-1506157786151-b8491531f063?w=400&q=80'); }
        .c-vid { height: 220px; background-image: url('https://images.unsplash.com/photo-1600607688969-a5bfcd64fd28?w=400&q=80'); }
        .c-ss { height: 140px; background-image: url('https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=400&q=80'); background-color: #fff; }
        .c-ss p, .c-ss h3 { color: #333; text-shadow: none; }
        .c-ss::after { background: linear-gradient(to top, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 100%); }

        /* --- è©³ç´°ç”»é¢ï¼ˆã‚°ãƒªãƒƒãƒ‰ï¼‰ --- */
        .detail-info { padding: 0 20px; margin-bottom: 15px; }
        .di-title { font-size: 24px; font-weight: 700; margin-bottom: 4px; }
        .di-sub { font-size: 13px; color: var(--subtext); transition: all 0.3s; }
        
        .grid-header { padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; font-size: 14px; color: var(--subtext); font-weight: 600; }

        .media-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; padding: 0 2px; }
        .media-grid.two-cols { grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 0 20px; }
        .m-item { position: relative; aspect-ratio: 1/1; background: var(--surface-light); cursor: pointer; overflow: hidden; border-radius: 4px; transition: opacity 0.3s, transform 0.3s; }
        .media-grid.two-cols .m-item { border-radius: 12px; }
        .m-item img { width: 100%; height: 100%; object-fit: cover; transition: filter 0.2s, transform 0.2s; }
        
        .m-vid-time, .m-size { position: absolute; bottom: 8px; left: 8px; background: rgba(0,0,0,0.6); color: #fff; font-size: 10px; font-weight: 600; padding: 4px 8px; border-radius: 6px; }
        .m-size { background: var(--accent); }
        
        .m-check { position: absolute; bottom: 8px; right: 8px; width: 22px; height: 22px; border-radius: 50%; border: 2px solid #fff; background: rgba(0,0,0,0.3); transition: all 0.2s; z-index: 2; }
        .m-item.checked .m-check { background: var(--danger); border-color: var(--danger); display: flex; align-items: center; justify-content: center; transform: scale(1.1); }
        .m-item.checked .m-check::after { content: 'âœ“'; font-size: 14px; font-weight: bold; }
        .m-item.checked img { filter: brightness(0.6); transform: scale(1.05); }

        /* é¡ä¼¼ã‚°ãƒ«ãƒ¼ãƒ— */
        .sim-group { margin-bottom: 20px; transition: all 0.3s; overflow: hidden; }
        .sg-header { padding: 10px 20px; font-size: 14px; font-weight: 600; display: flex; justify-content: space-between; }
        .sg-badge { position: absolute; top: 8px; left: 8px; background: #fff; color: #000; font-size: 10px; font-weight: 700; padding: 4px 8px; border-radius: 6px; display: flex; align-items: center; gap: 4px; z-index: 2; }
        .sg-badge span { color: var(--accent); }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¯ãƒ©ã‚¹ */
        .m-item.deleting { transform: scale(0.8); opacity: 0; }
        
        /* å‰Šé™¤ãƒœã‚¿ãƒ³ãƒãƒ¼ */
        .delete-bar { position: fixed; bottom: 90px; left: 20px; right: 20px; background: var(--btn-blue); color: #fff; padding: 16px; border-radius: 16px; display: flex; justify-content: center; align-items: center; font-weight: 700; font-size: 16px; box-shadow: 0 4px 20px rgba(76, 86, 192, 0.4); cursor: pointer; z-index: 50; transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.3s; transform: translateY(150%); opacity: 0; pointer-events: none; }
        .delete-bar.show { transform: translateY(0); opacity: 1; pointer-events: auto; }
        .delete-bar:active { transform: translateY(0) scale(0.97); }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        nav { position: absolute; bottom: 0; left: 0; width: 100%; height: 85px; background: rgba(28,30,43,0.95); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); display: flex; justify-content: space-around; align-items: center; padding-bottom: 20px; border-top: 1px solid var(--border); z-index: 40; }
        .ni { display: flex; flex-direction: column; align-items: center; color: var(--subtext); font-size: 10px; font-weight: 600; cursor: pointer; transition: color 0.2s; width: 60px; }
        .ni.on { color: var(--accent); }
        .nic { font-size: 24px; margin-bottom: 4px; }

        /* é–‹ç™ºç”¨ãƒ‘ãƒãƒ« (è¿½åŠ ã‚¿ãƒ–å†…) */
        .tool-list { display: flex; flex-direction: column; gap: 12px; margin-top: 20px; }
        .tool-item { background: var(--surface); border-radius: 14px; padding: 16px 20px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; font-size: 15px; font-weight: 600;}
    </style>
</head>
<body>
<div id="app">
    <header id="home-header">
        <h1>ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸</h1>
        </header>

    <main id="home" class="view active">
        <div class="storage-info">
            <div class="s-text"><span class="blue" id="home-used-gb">536 GB</span> ã‚’ä½¿ç”¨ä¸­ : å…¨ 2,000 GB</div>
            <div class="s-pct" id="home-pct">26.8% ä½¿ç”¨æ¸ˆã¿</div>
        </div>
        <div class="s-bar-bg"><div class="s-bar-fill" id="home-bar"></div></div>

        <div class="search-bar">
            <span>ğŸ”</span> Search...
        </div>

        <div class="masonry">
            <div class="m-col">
                <div class="card c-sim" onclick="navTo('similar-photos')">
                    <div class="card-content"><h3>ä¼¼ã¦ã„ã‚‹å†™çœŸ</h3><p id="card-sim-sz">24.4 GB</p></div>
                </div>
                <div class="card c-vid-sim" onclick="navTo('similar-videos')">
                    <div class="card-content"><h3>é¡ä¼¼ã®ãƒ“ãƒ‡ã‚ª</h3><p id="card-simvid-sz">1.5 GB</p></div>
                </div>
            </div>
            <div class="m-col">
                <div class="card c-vid" onclick="navTo('videos')">
                    <div class="card-content"><h3>å‹•ç”»ã‚’æ•´ç†</h3><p id="card-vid-sz">14.3 GB</p></div>
                </div>
                <div class="card c-ss" onclick="navTo('screenshots')">
                    <div class="card-content"><h3>ã‚¹ã‚¯ã‚·ãƒ§</h3><p id="card-ss-sz">246 MB</p></div>
                </div>
            </div>
        </div>
    </main>

    <div id="similar-photos" class="view" style="padding-top:0;">
        <div class="sub-header">
            <div class="sh-left"><span class="sh-back" onclick="navTo('home')">â€¹</span> ä¼¼ã¦ã„ã¾ã™</div>
            <div class="sh-actions">
                <div class="btn-round">â‰¡</div>
                <div class="btn-capsule" onclick="toggleSelectAll('similar-photos', this)" data-all="false">âœ“ å…¨ã¦é¸æŠ</div>
            </div>
        </div>
        <div class="detail-info"><div class="di-sub" id="sim-count-text">4æšã®å†™çœŸ (24.4 GB)</div></div>

        <div class="sim-group" id="sim-g1">
            <div class="sg-header"><span>2 ä¼¼ã¦ã„ã¾ã™</span></div>
            <div class="media-grid two-cols">
                <div class="m-item" data-mb="12200" onclick="toggleItem(this, 'similar-photos')">
                    <div class="sg-badge"><span>â˜…</span>æœ€é«˜</div>
                    <img src="https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=300&q=80">
                    <div class="m-check"></div>
                </div>
                <div class="m-item checked" data-mb="12200" onclick="toggleItem(this, 'similar-photos')">
                    <img src="https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=300&q=80&blur=2">
                    <div class="m-check"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="videos" class="view" style="padding-top:0;">
        <div class="sub-header">
            <div class="sh-left"><span class="sh-back" onclick="navTo('home')">â€¹</span> å‹•ç”»ã‚’æ•´ç†</div>
            <div class="sh-actions"><div class="btn-round">â‰¡</div><div class="btn-capsule" onclick="toggleSelectAll('videos', this)" data-all="false">âœ“ å…¨ã¦é¸æŠ</div></div>
        </div>
        <div class="detail-info"><div class="di-sub" id="vid-count-text">4 ã‚¢ã‚¤ãƒ†ãƒ  (14.3 GB)</div></div>
        <div class="media-grid two-cols">
            <div class="m-item" data-mb="6860" onclick="toggleItem(this, 'videos')">
                <img src="https://images.unsplash.com/photo-1600607688969-a5bfcd64fd28?w=300&q=80">
                <span class="m-size">6.86 GB</span><div class="m-check"></div>
            </div>
            <div class="m-item" data-mb="4060" onclick="toggleItem(this, 'videos')">
                <img src="https://images.unsplash.com/photo-1531306728370-53bfd6202e88?w=300&q=80">
                <span class="m-size">4.06 GB</span><div class="m-check"></div>
            </div>
            <div class="m-item" data-mb="3380" onclick="toggleItem(this, 'videos')">
                <img src="https://images.unsplash.com/photo-1506157786151-b8491531f063?w=300&q=80">
                <span class="m-size">3.38 GB</span><div class="m-check"></div>
            </div>
        </div>
    </div>

    <div id="screenshots" class="view" style="padding-top:0;">
        <div class="sub-header">
            <div class="sh-left"><span class="sh-back" onclick="navTo('home')">â€¹</span> ã‚¹ã‚¯ã‚·ãƒ§</div>
            <div class="sh-actions"><div class="btn-round">â‰¡</div><div class="btn-capsule" onclick="toggleSelectAll('screenshots', this)" data-all="false">âœ“ å…¨ã¦é¸æŠ</div></div>
        </div>
        <div class="detail-info"><div class="di-sub" id="ss-count-text">6æšã®å†™çœŸ (246 MB)</div></div>
        <div class="media-grid">
            <div class="m-item checked" data-mb="41" onclick="toggleItem(this, 'screenshots')"><img src="https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=200&q=80"><div class="m-check"></div></div>
            <div class="m-item checked" data-mb="41" onclick="toggleItem(this, 'screenshots')"><img src="https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=200&q=80&blur=1"><div class="m-check"></div></div>
            <div class="m-item checked" data-mb="41" onclick="toggleItem(this, 'screenshots')"><img src="https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=200&q=80&sepia=1"><div class="m-check"></div></div>
            <div class="m-item" data-mb="41" onclick="toggleItem(this, 'screenshots')"><img src="https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=200&q=80"><div class="m-check"></div></div>
            <div class="m-item" data-mb="41" onclick="toggleItem(this, 'screenshots')"><img src="https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=200&q=80&blur=1"><div class="m-check"></div></div>
            <div class="m-item" data-mb="41" onclick="toggleItem(this, 'screenshots')"><img src="https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=200&q=80&sepia=1"><div class="m-check"></div></div>
        </div>
    </div>

    <div id="similar-videos" class="view" style="padding-top:0;">
        <div class="sub-header">
            <div class="sh-left"><span class="sh-back" onclick="navTo('home')">â€¹</span> é¡ä¼¼ã®ãƒ“ãƒ‡ã‚ª</div>
            <div class="sh-actions"><div class="btn-round">â‰¡</div><div class="btn-capsule" onclick="toggleSelectAll('similar-videos', this)" data-all="false">âœ“ å…¨ã¦é¸æŠ</div></div>
        </div>
        <div class="detail-info"><div class="di-sub" id="simvid-count-text">2 ã‚¢ã‚¤ãƒ†ãƒ  (1.5 GB)</div></div>
        <div class="sim-group">
            <div class="sg-header"><span>2 ä¼¼ã¦ã„ã¾ã™</span></div>
            <div class="media-grid two-cols">
                <div class="m-item" data-mb="750" onclick="toggleItem(this, 'similar-videos')">
                    <img src="https://images.unsplash.com/photo-1506157786151-b8491531f063?w=300&q=80">
                    <span class="m-vid-time">00:24 â–·</span><div class="m-check"></div>
                </div>
                <div class="m-item checked" data-mb="750" onclick="toggleItem(this, 'similar-videos')">
                    <img src="https://images.unsplash.com/photo-1506157786151-b8491531f063?w=300&q=80&blur=2">
                    <span class="m-vid-time">00:08 â–·</span><div class="m-check"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="global-delete-bar" class="delete-bar" onclick="executeDelete()">
        ğŸ—‘ <span id="del-text">å‰Šé™¤</span>
    </div>

    <header id="tools-header" style="display:none;"><h1>è¿½åŠ </h1></header>
    <main id="tools" class="view">
        <div style="color:var(--subtext); font-size:13px; margin-top:20px;">ãƒ‡ãƒ¢ç‰ˆã«ã¤ãã€ä»–ã®æ©Ÿèƒ½ã¯æº–å‚™ä¸­ã§ã™ã€‚</div>
        <div class="tool-list">
            <div class="tool-item"><span>ğŸ“Š ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ</span><span>â€º</span></div>
            <div class="tool-item"><span>âš¡ å……é›»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</span><span>â€º</span></div>
            <div class="tool-item"><span>ğŸ”’ ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒ•ã‚©ãƒ«ãƒ€ãƒ¼</span><span>â€º</span></div>
        </div>
    </main>

    <nav>
        <div class="ni on" data-t="home" onclick="navTo('home')"><div class="nic">ğŸ </div><span>ãƒ›ãƒ¼ãƒ </span></div>
        <div class="ni" data-t="swipe" onclick="alert('ã‚¹ãƒ¯ã‚¤ãƒ—æ©Ÿèƒ½ã¯åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã§ç¨¼åƒä¸­ã§ã™')"><div class="nic">ğŸƒ</div><span>ã‚¹ãƒ¯ã‚¤ãƒ—</span></div>
        <div class="ni" data-t="tools" onclick="navTo('tools')"><div class="nic">âš™ï¸</div><span>è¿½åŠ </span></div>
    </nav>
</div>

<script>
// --- ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ç®¡ç† (ãƒªã‚¢ãƒ«ãªå®¹é‡è¨ˆç®—ç”¨) ---
let totalStorageMB = 2000 * 1024; // 2TB
let usedStorageMB = 536 * 1024;   // 536GB

// ç¾åœ¨é–‹ã„ã¦ã„ã‚‹è©³ç´°ãƒ“ãƒ¥ãƒ¼
let activeDetailView = null;

// --- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ ---
function navTo(id) {
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    document.getElementById(id).classList.add('active');

    // ã‚¿ãƒ–ã®åˆ‡ã‚Šæ›¿ãˆ
    if (['home', 'tools'].includes(id)) {
        document.querySelectorAll('.ni').forEach(x => x.classList.remove('on'));
        document.querySelector(`.ni[data-t="${id}"]`).classList.add('on');
        document.getElementById('home-header').style.display = id === 'home' ? 'flex' : 'none';
        document.getElementById('tools-header').style.display = id === 'tools' ? 'flex' : 'none';
        
        // ãƒ›ãƒ¼ãƒ ã«æˆ»ã£ãŸã‚‰å‰Šé™¤ãƒãƒ¼ã‚’éš ã™
        document.getElementById('global-delete-bar').classList.remove('show');
        activeDetailView = null;
        updateHomeDisplay();
    } else {
        document.getElementById('home-header').style.display = 'none';
        document.getElementById('tools-header').style.display = 'none';
        activeDetailView = id;
        updateDeleteBar(); // ãƒ“ãƒ¥ãƒ¼ã‚’é–‹ã„ãŸç¬é–“ã«é¸æŠçŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãƒãƒ¼ã‚’è¡¨ç¤º
    }
}

// --- ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•° ---
function formatSize(mb) {
    if (mb >= 1000) {
        return (mb / 1024).toFixed(1) + ' GB';
    }
    return Math.round(mb) + ' MB';
}

// --- é¸æŠã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ---
function toggleItem(el, viewId) {
    // ãƒ™ã‚¹ãƒˆã‚·ãƒ§ãƒƒãƒˆ(â˜…)ã¯é¸æŠã§ããªã„ä»•æ§˜ã«ã™ã‚‹å ´åˆ
    if(el.querySelector('.sg-badge')) {
        alert("ã“ã‚Œã¯ãƒ™ã‚¹ãƒˆã‚·ãƒ§ãƒƒãƒˆ(KEEP)ã¨ã—ã¦ä¿è­·ã•ã‚Œã¦ã„ã¾ã™ã€‚");
        return;
    }
    el.classList.toggle('checked');
    updateDeleteBar();
}

function toggleSelectAll(viewId, btnNode) {
    const view = document.getElementById(viewId);
    const isAll = btnNode.dataset.all === 'true'; // ç¾åœ¨ã®çŠ¶æ…‹
    
    // å…¨ã¦ã®ã‚¢ã‚¤ãƒ†ãƒ (ãƒ™ã‚¹ãƒˆã‚·ãƒ§ãƒƒãƒˆä»¥å¤–)ã‚’å–å¾—
    const items = Array.from(view.querySelectorAll('.m-item')).filter(el => !el.querySelector('.sg-badge'));
    
    items.forEach(el => {
        if (isAll) {
            el.classList.remove('checked'); // å…¨è§£é™¤
        } else {
            el.classList.add('checked'); // å…¨é¸æŠ
        }
    });

    // ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã¨çŠ¶æ…‹ã‚’æ›´æ–°
    btnNode.dataset.all = !isAll;
    btnNode.innerHTML = !isAll ? 'Ã— é¸æŠã‚’è§£é™¤' : 'âœ“ å…¨ã¦é¸æŠ';
    
    updateDeleteBar();
}

// --- å‰Šé™¤ãƒãƒ¼ã®æ›´æ–° ---
function updateDeleteBar() {
    if(!activeDetailView) return;
    
    const view = document.getElementById(activeDetailView);
    const checkedItems = view.querySelectorAll('.m-item.checked');
    const bar = document.getElementById('global-delete-bar');
    const txtNode = document.getElementById('del-text');
    
    if (checkedItems.length > 0) {
        let totalMB = 0;
        checkedItems.forEach(item => {
            totalMB += parseFloat(item.dataset.mb || 0);
        });
        
        let label = activeDetailView === 'screenshots' ? 'ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ' : (activeDetailView === 'videos' ? 'ã®å‹•ç”»' : 'ã®é¡ä¼¼ã‚¢ã‚¤ãƒ†ãƒ ');
        txtNode.innerText = `${checkedItems.length}${label}ã‚’å‰Šé™¤ (${formatSize(totalMB)})`;
        bar.classList.add('show');
    } else {
        bar.classList.remove('show');
    }
}

// --- å‰Šé™¤ã®å®Ÿè¡Œ ---
function executeDelete() {
    if(!activeDetailView) return;
    
    const view = document.getElementById(activeDetailView);
    const checkedItems = view.querySelectorAll('.m-item.checked');
    
    if(checkedItems.length === 0) return;

    // ãƒã‚¤ãƒ†ã‚£ãƒ–é¢¨ã®ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
    if(confirm(`${checkedItems.length}ä»¶ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’iPhoneã‹ã‚‰å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
        
        let freedMB = 0;
        
        // å‰Šé™¤ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨DOMã‹ã‚‰ã®å‰Šé™¤
        checkedItems.forEach(el => {
            freedMB += parseFloat(el.dataset.mb || 0);
            el.classList.add('deleting'); // ç¸®ã‚“ã§æ¶ˆãˆã‚‹ã‚¯ãƒ©ã‚¹
            setTimeout(() => {
                el.remove();
                recalculateViewTotal(view.id); // DOMå‰Šé™¤å¾Œã«è¨ˆç®—ã‚’ã‚„ã‚Šç›´ã™
            }, 300); // CSSã®transitionæ™‚é–“ã¨åˆã‚ã›ã‚‹
        });
        
        // å…¨ä½“ã®å®¹é‡ã‹ã‚‰å·®ã—å¼•ã
        usedStorageMB -= freedMB;
        
        // å‰Šé™¤ãƒãƒ¼ã‚’éš ã™
        document.getElementById('global-delete-bar').classList.remove('show');
        
        // é¸æŠå…¨è§£é™¤ãƒœã‚¿ãƒ³ã®ãƒªã‚»ãƒƒãƒˆ
        const btn = view.querySelector('.btn-capsule');
        if(btn) { btn.dataset.all = 'false'; btn.innerHTML = 'âœ“ å…¨ã¦é¸æŠ'; }
    }
}

// å„ã‚«ãƒ†ã‚´ãƒªã®è©³ç´°ç”»é¢ã®åˆè¨ˆè¡¨ç¤ºï¼ˆ1088æšã®å†™çœŸ...ãªã©ï¼‰ã‚’å†è¨ˆç®—
function recalculateViewTotal(viewId) {
    const view = document.getElementById(viewId);
    const remainingItems = view.querySelectorAll('.m-item');
    let totalMB = 0;
    
    remainingItems.forEach(el => {
        totalMB += parseFloat(el.dataset.mb || 0);
    });

    // ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ã®æ›´æ–°
    let labelId = '';
    let unitName = 'ã‚¢ã‚¤ãƒ†ãƒ ';
    if(viewId === 'similar-photos') { labelId = 'sim-count-text'; unitName = 'æšã®å†™çœŸ'; }
    if(viewId === 'videos') { labelId = 'vid-count-text'; unitName = 'ã‚¢ã‚¤ãƒ†ãƒ '; }
    if(viewId === 'screenshots') { labelId = 'ss-count-text'; unitName = 'æšã®å†™çœŸ'; }
    if(viewId === 'similar-videos') { labelId = 'simvid-count-text'; unitName = 'ã‚¢ã‚¤ãƒ†ãƒ '; }
    
    const txtNode = document.getElementById(labelId);
    if(txtNode) {
        txtNode.innerText = `${remainingItems.length} ${unitName} (${formatSize(totalMB)})`;
    }

    // ãƒ›ãƒ¼ãƒ ç”»é¢ã®ã‚«ãƒ¼ãƒ‰ã®æ•°å­—ã‚‚æ›´æ–°ã—ã¦ãŠã
    if(viewId === 'similar-photos') document.getElementById('card-sim-sz').innerText = formatSize(totalMB);
    if(viewId === 'videos') document.getElementById('card-vid-sz').innerText = formatSize(totalMB);
    if(viewId === 'screenshots') document.getElementById('card-ss-sz').innerText = formatSize(totalMB);
    if(viewId === 'similar-videos') document.getElementById('card-simvid-sz').innerText = formatSize(totalMB);
}

// --- ãƒ›ãƒ¼ãƒ ç”»é¢ã®å®¹é‡è¡¨ç¤ºæ›´æ–° ---
function updateHomeDisplay() {
    // GBæ›ç®—
    const usedGB = (usedStorageMB / 1024).toFixed(1);
    const pct = ((usedStorageMB / totalStorageMB) * 100).toFixed(1);
    
    document.getElementById('home-used-gb').innerText = `${usedGB} GB`;
    document.getElementById('home-pct').innerText = `${pct}% ä½¿ç”¨æ¸ˆã¿`;
    document.getElementById('home-bar').style.width = `${pct}%`;
}

// åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', () => {
    // åˆæœŸçŠ¶æ…‹ã®è¡¨ç¤ºã‚’ã‚»ãƒƒãƒˆ
    updateHomeDisplay();
});
</script>
</body>
</html>
